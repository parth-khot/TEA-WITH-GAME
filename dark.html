<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Theme Toggle with Reveal</title>
  <style>
    :root {
      --background-light: #ffffff;
      --text-light: #000000;
      --background-dark: #1a1a1a;
      --text-dark: #f5f5f5;

      --bg: var(--background-light);
      --text: var(--text-light);

      --toggle-color: #000;
    }

    html.dark {
      --bg: var(--background-dark);
      --text: var(--text-dark);
      --toggle-color: #fff;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    /* Toggle button */
    .toggle {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%) scale(.5);
      cursor: pointer;
      z-index: 10;
    }

    .toggle input {
      display: none;
    }

    .toggle input+div {
      border-radius: 50%;
      width: 36px;
      height: 36px;
      position: relative;
      box-shadow: inset 16px -16px 0 0 var(--toggle-color);
      transform: scale(1) rotate(-2deg);
      transition: box-shadow .5s ease 0s, transform .4s ease .1s;
    }

    .toggle input+div:before {
      content: '';
      width: inherit;
      height: inherit;
      border-radius: inherit;
      position: absolute;
      left: 0;
      top: 0;
      background: light-dark(transparent, var(--toggle-color));
      transition: background .3s ease;
    }

    .toggle input+div:after {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin: -4px 0 0 -4px;
      position: absolute;
      top: 50%;
      left: 50%;
      box-shadow: 0 -23px 0 var(--toggle-color),
        0 23px 0 var(--toggle-color),
        23px 0 0 var(--toggle-color),
        -23px 0 0 var(--toggle-color),
        15px 15px 0 var(--toggle-color),
        -15px 15px 0 var(--toggle-color),
        15px -15px 0 var(--toggle-color),
        -15px -15px 0 var(--toggle-color);
      transform: scale(0);
      transition: all .3s ease;
    }

    .toggle input:checked+div {
      box-shadow: inset 32px -32px 0 0 var(--background-color);
      transform: scale(.5) rotate(0deg);
      transition: transform .3s ease .1s, box-shadow .2s ease 0s;
    }

    .toggle input:checked+div:before {
      background: var(--toggle-color);
      transition: background .3s ease .1s;
    }

    .toggle input:checked+div:after {
      transform: scale(1.5);
      transition: transform .5s ease .15s;
    }

    /* Reveal Animations */
    @keyframes reveal-in {
      from {
        clip-path: circle(0% at var(--x) var(--y));
      }

      to {
        clip-path: circle(150% at var(--x) var(--y));
      }
    }

    @keyframes reveal-out {
      from {
        clip-path: circle(150% at var(--x) var(--y));
      }

      to {
        clip-path: circle(0% at var(--x) var(--y));
      }
    }

    ::view-transition-new(root) {
      animation: reveal-in 0.5s ease-in-out forwards;
      z-index: 1;
    }

    ::view-transition-old(root) {
      animation: reveal-out 0.5s ease-in-out forwards;
      animation-delay: 0.5s;
      z-index: 0;
    }

    ::view-transition-image-pair(root) {
      isolation: isolate;
    }
  </style>
</head>

<body>
  <!-- Toggle Button -->
  <label class="toggle">
    <input type="checkbox" id="themeToggle">
    <div></div>
  </label>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggleInput = document.getElementById('themeToggle');
      const root = document.documentElement;

      const applyTheme = (isDark) => {
        if (isDark) root.classList.add('dark');
        else root.classList.remove('dark');
      };

      // Load saved theme or system preference
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        toggleInput.checked = savedTheme === 'dark';
        applyTheme(savedTheme === 'dark');
      } else {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        toggleInput.checked = prefersDark;
        applyTheme(prefersDark);
      }

      toggleInput.addEventListener('change', (e) => {
        const x = e.clientX || window.innerWidth / 2;
        const y = e.clientY || window.innerHeight / 2;
        document.documentElement.style.setProperty("--x", x + "px");
        document.documentElement.style.setProperty("--y", y + "px");

        const isDark = toggleInput.checked;
        document.startViewTransition(() => {
          applyTheme(isDark);
        });

        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });
    });
  </script>
</body>

</html>
